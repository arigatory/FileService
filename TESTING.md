# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ FileService —Å Docker

## üöÄ –ó–∞–ø—É—Å–∫ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

1. **–ó–∞–ø—É—Å–∫–∞–µ–º –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã:**
```bash
docker-compose up -d
```

2. **–ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤:**
```bash
docker-compose ps
```

3. **–ñ–¥–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ (–ø—Ä–∏–º–µ—Ä–Ω–æ 30-60 —Å–µ–∫—É–Ω–¥):**
```bash
# –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–æ–≥–∏
docker-compose logs -f fileservice
```

## üåê –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã

- **FileService API**: http://localhost:7000
- **Swagger UI**: http://localhost:7000/swagger
- **MinIO 1 Console**: http://localhost:9011 (admin/minioadmin123)
- **MinIO 2 Console**: http://localhost:9012 (admin/minioadmin123)

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ REST API

```bash
# –ó–∞–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã
./test-api.sh
```

### 2. –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ curl

**–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞:**
```bash
echo "Test content" > test.txt
curl -X POST "http://localhost:7000/api/files/upload" \
  -F "file=@test.txt" \
  -F "tags=manual-test"
```

**–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ñ–∞–π–ª–µ:**
```bash
curl "http://localhost:7000/api/files/{FILE_ID}/info"
```

**–°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞:**
```bash
curl "http://localhost:7000/api/files/{FILE_ID}" -o downloaded.txt
```

**–£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞:**
```bash
curl -X DELETE "http://localhost:7000/api/files/{FILE_ID}"
```

### 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ –∫–ª–∏–µ–Ω—Ç—Å–∫—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É

```bash
cd examples/FileService.ExampleClient
dotnet run "http://localhost:7000"
```

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏ —Å–µ—Ä–≤–∏—Å–æ–≤
```bash
# FileService –ª–æ–≥–∏
docker-compose logs -f fileservice

# MinIO –ª–æ–≥–∏
docker-compose logs -f minio1 minio2
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∫–µ—Ç–æ–≤ –≤ MinIO
1. –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:9011
2. –í–æ–π–¥–∏—Ç–µ: admin / minioadmin123
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±–∞–∫–µ—Ç `primary-file-storage`

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ –Ω–∞–≥—Ä—É–∑–∫–∏
–ó–∞–≥—Ä—É–∑–∏—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–∞–π–ª–æ–≤ –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –æ–Ω–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –º–µ–∂–¥—É –¥–≤—É–º—è MinIO –∏–Ω—Å—Ç–∞–Ω—Å–∞–º–∏:

```bash
# –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–∞–π–ª–æ–≤
for i in {1..6}; do
  echo "Test file $i content" > test$i.txt
  curl -X POST "http://localhost:7000/api/files/upload" \
    -F "file=@test$i.txt" \
    -F "tags=load-balancing-test"
  rm test$i.txt
done
```

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª–∏ MinIO - —Ñ–∞–π–ª—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –º–µ–∂–¥—É –¥–≤—É–º—è –∏–Ω—Å—Ç–∞–Ω—Å–∞–º–∏.

## üßπ –û—á–∏—Å—Ç–∫–∞

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ —É–¥–∞–ª–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker-compose down

# –£–¥–∞–ª–∏—Ç—å –¥–∞–Ω–Ω—ã–µ (volumes)
docker-compose down -v

# –£–¥–∞–ª–∏—Ç—å –æ–±—Ä–∞–∑—ã
docker-compose down --rmi all -v
```

## üêõ Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: –°–µ—Ä–≤–∏—Å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
```bash
# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å
docker-compose ps

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–æ–≥–∏
docker-compose logs fileservice

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–∏—Å
docker-compose restart fileservice
```

### –ü—Ä–æ–±–ª–µ–º–∞: MinIO –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç
```bash
# –ü—Ä–æ–≤–µ—Ä—è–µ–º health check
docker-compose logs minio1 minio2

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º MinIO
docker-compose restart minio1 minio2 createbuckets
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ë–∞–∫–µ—Ç—ã –Ω–µ —Å–æ–∑–¥–∞–Ω—ã
```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ –±–∞–∫–µ—Ç–æ–≤
docker-compose restart createbuckets
docker-compose logs createbuckets
```

## üìä –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

‚úÖ **–£—Å–ø–µ—à–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–æ–ª–∂–Ω—ã –ø–æ–∫–∞–∑–∞—Ç—å:**
- –ó–∞–≥—Ä—É–∑–∫—É —Ñ–∞–π–ª–æ–≤ –≤ —Ä–∞–∑–Ω—ã–µ MinIO –∏–Ω—Å—Ç–∞–Ω—Å—ã (Round Robin)
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
- –ò–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∏ —Å–∫–∞—á–∞–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–æ–≤
- –£—Å–ø–µ—à–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
- –û–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ (404 –¥–ª—è –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ñ–∞–π–ª–æ–≤)

‚úÖ **–í –∫–æ–Ω—Å–æ–ª—è—Ö MinIO –≤—ã —É–≤–∏–¥–∏—Ç–µ:**
- –°–æ–∑–¥–∞–Ω–Ω—ã–µ –±–∞–∫–µ—Ç—ã: `primary-file-storage`, `secondary-file-storage`
- –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ: `yyyy/MM/dd/{uuid}.ext`
- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –º–µ–∂–¥—É –¥–≤—É–º—è –∏–Ω—Å—Ç–∞–Ω—Å–∞–º–∏